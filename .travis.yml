language: java

jdk:
  - openjdk8

before_install: cd GitToolBox

install: ./gradlew assemble --console plain

script: ./gradlew check integrationTest --console plain

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
  - rm -fr $HOME/.gradle/caches/*/scripts/
  - rm -fr $HOME/.gradle/caches/*/scripts-remapped/
  - rm -fr $HOME/.gradle/caches/*/fileHashes/
  - rm -fr $HOME/.gradle/caches/*/workerMain/
  - rm -f  $HOME/.gradle/caches/*/fileContent/*.lock
  - rm -f  $HOME/.gradle/caches/*/javaCompile/*.lock
  - rm -f  $HOME/.gradle/caches/*/javaCompile/jarAnalysis.bin
  - rm -f  $HOME/.gradle/caches/*/executionHistory/*.lock
  - rm -f  $HOME/.gradle/caches/*/generated-gradle-jars/*.lock
  - rm -f  $HOME/.gradle/caches/*/md-rule/*.lock
  - rm -f  $HOME/.gradle/caches/*/md-supplier/*.lock
  - rm -f  $HOME/.gradle/caches/jars-3/*.lock
  - rm -f  $HOME/.gradle/caches/transforms-1/transforms-1.lock
  - rm -f  $HOME/.gradle/caches/journal-1/file-access.bin
  - rm -f  $HOME/.gradle/caches/journal-1/*.lock
cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/

before_deploy: cd GitToolBox

deploy:
  skip_cleanup: true
  provider: script
  script: ./gradlew buildPlugin publishPlugin --console plain -Ppublish=true
  on:
    tags: true
